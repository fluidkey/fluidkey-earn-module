## Fluidkey Earn Module

The Fluidkey Earn Module is a Safe module that allows Fluidkey to automatically deposit funds into an ERC-4626 vault on behalf of the Safe. It is based on the [AutoSavings module](https://github.com/rhinestonewtf/core-modules/blob/main/src/AutoSavings/AutoSavings.sol) authored by Rhinestone.

## Audit

The Fluidkey Earn Module has successfully been audited by Ackee in March 2025. The audit report can be found [here](/audits/ackee-blockchain-fluidkey-earn-module-report.pdf).

## Deployment

* Salt: `f10ed4ee` (production) and `de4e` (development) with padding before
* Create3 factory: `0x4088E5933b8260ff2D9CA5CED4Bb796482A660f0`
* Owner: `0x9E3eba321427941868cB4123De97DAB145C9e7CD`
* Address: `0x74995e1075f1b0c308efacc56520d14e4954da6f` (production) and `0x63234d98a126b923a4570f516c064f05b135e00a` (development)

To deploy using the Create3 factory, first ensure you have set up your environment variables:
```bash
# .env
PRIVATE_KEY=your_private_key_here
```

Then run the deployment script to deploy the CREATE3Factory locked to the generated bytecode, and to get the calldata for the deployment:
```bash
forge script script/Deployer.s.sol \
    --rpc-url ${RPC_URL} \
    --broadcast \
    -vvv \
    --sig "run(address,address,address,bytes32)" \
    <authorized_relayer> \
    <wrapped_native_address> \
    <owner> \
    <salt>
```

The script will output:
- The bytecode hash of the module
- The expected address of the CREATE3Factory
- The calldata for deploying the FluidkeyEarnModule via the CREATE3Factory

This calldata can then be used in a Safe transaction or other wallet to perform the actual deployment.

> [!CAUTION]
> Make sure to use the correct wrapped native asset address for the chain you are deploying to as this cannot be changed once the contract is deployed.

## Configuration

To generate the calldata for setting or updating vault configurations in the Fluidkey Earn Module:

```bash
forge script script/ConfigSetter.s.sol -vvv
```

The script output includes:
- The complete calldata for the `setConfig` method
- The configuration hash in both decimal and hex format 
- The calldata needed for the `onInstall` method when installing the module on a Safe

## Contract Verification

To verify the contract on Etherscan, run the following command:
```bash
forge verify-contract \
    --chain-id <chain_id> \
    --num-of-optimizations 200 \
    --watch \
    --constructor-args $(cast abi-encode "constructor(address,address,address)" <authorized_relayer> <wrapped_native_address> <owner>) \
    --etherscan-api-key <etherscan_api_key> \
    --compiler-version v0.8.23 \
    <contract_address> \
    src/FluidkeyEarnModule.sol:FluidkeyEarnModule
```